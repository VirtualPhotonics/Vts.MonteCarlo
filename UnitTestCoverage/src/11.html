<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\lisa\Documents\Projects\UCI\VTS_Release\Vts.MonteCarlo\Vts.MonteCarlo.CommandLineApplication\CommandLine.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;

namespace Vts.MonteCarlo.CommandLineApplication;

internal static class CommandLine
{
    public class Switch // Class that encapsulates switch data.
    {
        public Switch(string name, string shortForm, Action&lt;IEnumerable&lt;string&gt;&gt; handler)
        {
            Name = name;
            ShortForm = shortForm;
            Handler = handler;
        }

        public Switch(string name, Action&lt;IEnumerable&lt;string&gt;&gt; handler)
        {
            Name = name;
            ShortForm = null;
            Handler = handler;
        }

        public string Name { get; private set; }
        public string ShortForm { get; private set; }
        public Action&lt;IEnumerable&lt;string&gt;&gt; Handler { get; private set; }

        public int InvokeHandler(string[] values)
        {
            Handler(values);
            return 1;
        }
    }

    /* The regex that extracts names and comma-separated values for switches 
        in the form (&lt;switch&gt;[=&quot;value 1&quot;,value2,...])+ */
    private static readonly Regex ArgRegex =
        new Regex(@&quot;(?&lt;name&gt;[^=]+)=?((?&lt;quoted&gt;\&quot;&quot;?)(?&lt;value&gt;(?(quoted)[^\&quot;&quot;]+|[^,]+))\&quot;&quot;?,?)*&quot;,
            RegexOptions.Compiled | RegexOptions.CultureInvariant |
            RegexOptions.ExplicitCapture | RegexOptions.IgnoreCase);

    private const string NameGroup = &quot;name&quot;; // Names of capture groups
    private const string ValueGroup = &quot;value&quot;;

    public static void Process(this string[] args, Action printUsage, params Switch[] switches)
    {
        /* Run through all matches in the argument list and if any of the switches 
            match, get the values and invoke the handler we were given. We do a Sum() 
            here for 2 reasons; a) To actually run the handlers
            and b) see if any were invoked at all (each returns 1 if invoked).
            If none were invoked, we simply invoke the printUsage handler. */
        if ((from arg in args
                from Match match in ArgRegex.Matches(arg)
                from s in switches
                where match.Success &amp;&amp;
                      ((string.Compare(match.Groups[NameGroup].Value, s.Name, true) == 0) ||
                       (string.Compare(match.Groups[NameGroup].Value, s.ShortForm, true) == 0))
                select s.InvokeHandler(match.Groups[ValueGroup].Value.Split(&#39;,&#39;))).Sum() == 0)
            printUsage(); // We didn&#39;t find any switches
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,90,1],[13,9,13,10,1],[14,13,14,25,1],[15,13,15,35,1],[16,13,16,31,1],[17,9,17,10,1],[19,9,19,72,1],[20,9,20,10,1],[21,13,21,25,1],[22,13,22,30,1],[23,13,23,31,1],[24,9,24,10,1],[26,30,26,34,1],[26,35,26,47,1],[27,35,27,39,1],[27,40,27,52,1],[28,54,28,58,1],[28,59,28,71,1],[31,9,31,10,1],[32,13,32,29,1],[33,13,33,22,1],[34,9,34,10,1],[39,5,42,69,1],[48,5,48,6,1],[54,9,55,17,1],[55,17,55,37,1],[55,37,55,58,1],[55,58,56,17,1],[56,17,56,27,1],[56,27,56,35,1],[56,35,57,23,1],[57,23,59,96,1],[59,96,60,24,1],[60,24,60,82,1],[60,82,60,95,1],[61,13,61,26,1],[62,5,62,6,1]]);
    </script>
  </body>
</html>